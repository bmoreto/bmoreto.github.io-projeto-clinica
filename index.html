<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Patient Management System</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <main class="container" id="home">
    <h1 class="title">Patient Management System</h1>

    {% if message %}
    <div class="alert success">{{ message }}</div>
    {% endif %}

    {% if error %}
    <div class="alert error">{{ error }}</div>
    {% endif %}

    <section id="register" class="section">
      <h2 class="subtitle">Register a new patient</h2>
      <form method="post" action="/" class="form">
        <input type="hidden" name="action" value="register">

        <div class="field">
          <label for="name">Name</label>
          <input id="name" type="text" name="name">
        </div>

        <div class="field">
          <label for="age">Age</label>
          <input id="age" type="number" name="age">
        </div>

        <div class="field">
          <label for="phone">Phone</label>
          <input id="phone" type="text" name="phone">
        </div>

        <div class="field">
          <label for="cpf">ID (CPF)</label>
          <input id="cpf" type="text" name="cpf">
        </div>

        <button type="submit" class="btn">Register patient</button>
      </form>
    </section>

    <section id="patients" class="section">
      <h2 class="subtitle">Registered patients</h2>

      {% if patients %}
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Age</th>
            <th>Phone</th>
            <th>ID (CPF)</th>
          </tr>
        </thead>
        <tbody>
          {% for p in patients %}
          <tr>
            <td>{{ loop.index0 }}</td>
            <td>{{ p.name }}</td>
            <td>{{ p.age }}</td>
            <td>{{ p.phone }}</td>
            <td>{{ p.cpf }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No patients registered yet.</p>
      {% endif %}
    </section>

    <section id="statistics" class="section">
      <h2 class="subtitle">Statistics</h2>

      {% if stats %}
      <p><strong>Total patients:</strong> {{ stats.total }}</p>
      <p><strong>Average age:</strong> {{ stats.avg_age }}</p>
      <p><strong>Youngest patient:</strong> {{ stats.youngest.name }} ({{ stats.youngest.age }})</p>
      <p><strong>Oldest patient:</strong> {{ stats.oldest.name }} ({{ stats.oldest.age }})</p>
      {% else %}
      <p>No data available.</p>
      {% endif %}
    </section>

    <section id="search" class="section">
      <h2 class="subtitle">Search for a patient</h2>

      <form method="post" action="/" class="form">
        <input type="hidden" name="action" value="search">

        <div class="field">
          <label for="search_name">Name or partial name</label>
          <input id="search_name" type="text" name="search_name" value="{{ search_query or '' }}">
        </div>

        <button type="submit" class="btn">Search</button>
      </form>

      {% if search_results is not none %}
      {% if search_results %}
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Age</th>
            <th>Phone</th>
            <th>ID (CPF)</th>
          </tr>
        </thead>
        <tbody>
          {% for p in search_results %}
          <tr>
            <td>{{ p.name }}</td>
            <td>{{ p.age }}</td>
            <td>{{ p.phone }}</td>
            <td>{{ p.cpf }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No patients found.</p>
      {% endif %}
      {% endif %}
    </section>

    <section id="queue" class="section">
      <h2 class="subtitle">Add patient to Current Queue</h2>

      {% if patients %}
      <form method="post" action="/" class="form">
        <input type="hidden" name="action" value="add_to_queue">

        <div class="field">
          <label for="patient_index">Select a patient</label>
          <select id="patient_index" name="patient_index">
            {% for p in patients %}
            <option value="{{ loop.index0 }}">{{ p.name }} ({{ p.cpf }})</option>
            {% endfor %}
          </select>
        </div>

        <button type="submit" class="btn">Add to queue</button>
      </form>
      {% else %}
      <p>No patients available. Register patients first.</p>
      {% endif %}
    </section>

    <section id="current-queue" class="section">
      <h2 class="subtitle">Current Queue</h2>

      {% if current_queue %}
      <ul class="queue">
        {% for p in current_queue %}
        <li>{{ p.name }} — {{ p.age }} years — {{ p.phone }} — {{ p.cpf }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No patients in the current queue.</p>
      {% endif %}

      <form method="post" action="/" class="form form-inline">
        <input type="hidden" name="action" value="attend_next">
        <button class="btn">Attend next patient</button>
      </form>
    </section>

  </main>

</body>

</html>