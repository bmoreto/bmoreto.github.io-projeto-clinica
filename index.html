<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Patient Management System</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>

  <div class="container" id="home">

    <h1>Patient Management System</h1>

    {% if message %}
    <div class="message success">{{ message }}</div>
    {% endif %}

    {% if error %}
    <div class="message error">{{ error }}</div>
    {% endif %}

    <div class="section" id="register">
      <h2>Register a new patient</h2>
      <form method="post" action="/" autocomplete="off">
        <input type="hidden" name="action" value="register">

        <label>Name:</label>
        <input type="text" name="name">

        <label>Age:</label>
        <input type="number" name="age">

        <label>Phone:</label>
        <input type="text" name="phone">

        <label>ID (CPF):</label>
        <input type="text" name="cpf">

        <button type="submit">Register patient</button>
      </form>
    </div>

    <div class="section" id="patients">
      <h2>Registered patients</h2>

      {% if patients %}
      <table>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Age</th>
          <th>Phone</th>
          <th>ID (CPF)</th>
        </tr>
        {% for p in patients %}
        <tr>
          <td>{{ loop.index0 }}</td>
          <td>{{ p.name }}</td>
          <td>{{ p.age }}</td>
          <td>{{ p.phone }}</td>
          <td>{{ p.cpf }}</td>
        </tr>
        {% endfor %}
      </table>
      {% else %}
      <p>No patients registered yet.</p>
      {% endif %}
    </div>

    <div class="section" id="statistics">
      <h2>Statistics</h2>

      {% if stats %}
      <p><strong>Total patients:</strong> {{ stats.total }}</p>
      <p><strong>Average age:</strong> {{ stats.avg_age }} years</p>
      <p><strong>Youngest patient:</strong>
        {{ stats.youngest.name }} ({{ stats.youngest.age }} years)
      </p>
      <p><strong>Oldest patient:</strong>
        {{ stats.oldest.name }} ({{ stats.oldest.age }} years)
      </p>
      {% else %}
      <p>No data available. Register patients first.</p>
      {% endif %}
    </div>

    <div class="section" id="search">
      <h2>Search for a patient</h2>

      <form method="post" action="/">
        <input type="hidden" name="action" value="search">

        <label>Enter a name or part of a name:</label>
        <input type="text" name="search_name" value="{{ search_query or '' }}">

        <button type="submit">Search</button>
      </form>

      {% if search_results is not none %}
      {% if search_results %}
      <h3>Search results:</h3>
      <table>
        <tr>
          <th>Name</th>
          <th>Age</th>
          <th>Phone</th>
          <th>ID (CPF)</th>
        </tr>
        {% for p in search_results %}
        <tr>
          <td>{{ p.name }}</td>
          <td>{{ p.age }}</td>
          <td>{{ p.phone }}</td>
          <td>{{ p.cpf }}</td>
        </tr>
        {% endfor %}
      </table>
      {% else %}
      <p>No patients found with that name.</p>
      {% endif %}
      {% endif %}
    </div>

    <div class="section" id="queue">
      <h2>Add patient to Current Queue</h2>

      {% if patients %}
      <form method="post" action="/">
        <input type="hidden" name="action" value="add_to_queue">

        <label>Select a patient:</label>
        <select name="patient_index">
          {% for p in patients %}
          <option value="{{ loop.index0 }}">
            {{ loop.index0 }} - {{ p.name }} ({{ p.cpf }})
          </option>
          {% endfor %}
        </select>

        <button type="submit">Add to current queue</button>
      </form>
      {% else %}
      <p>You must register patients first.</p>
      {% endif %}

      <h2>Current Queue</h2>

      {% if current_queue %}
      <ol class="queue-list">
        {% for p in current_queue %}
        <li>
          {{ p.name }} | {{ p.age }} years |
          {{ p.phone }} | ID: {{ p.cpf }}
        </li>
        {% endfor %}
      </ol>
      {% else %}
      <p>No patients in the current queue.</p>
      {% endif %}

      <form method="post" action="/">
        <input type="hidden" name="action" value="attend_next">
        <button type="submit">Attend next patient</button>
      </form>
    </div>

  </div>

</body>

</html>